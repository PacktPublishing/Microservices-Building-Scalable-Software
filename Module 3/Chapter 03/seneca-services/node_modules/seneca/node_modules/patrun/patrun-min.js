/* Copyright (c) 2013-2015 Richard Rodger, MIT License, https://github.com/rjrodger/patrun */
(function(){"use strict";var n=this,e=n.patrun,r="undefined"!=typeof require,t=n._||r&&require("lodash");if(!t)throw new Error("patrun requires underscore, see http://underscorejs.org");var u=n.gex||r&&require("gex");if(!u)throw new Error("patrun requires gex, see https://github.com/rjrodger/gex");var i=n.patrun=function(r){function i(n,e,r){if(r){var t=n.g=n.g||{},u=t[e]=t[e]||[];u.push(r),u.sort(function(n,e){return n.val$<e.val$})}}r=r||{};var o={},s={};return o.top=s,o.noConflict=function(){return n.patrun=e,o},o.add=function(n,e){n=t.clone(n);var l=t.isFunction(r)?r.call(o,n,e):null,a=t.keys(n),v=[],f=[];a.forEach(function(e){var t=n[e];null!=t&&(t=String(t),n[e]=t,(r.gex&&t.match(/[\*\?]/)?f:v).push(e))}),v=v.sort(),f=f.sort(),a=v.concat(f);for(var d,c=s,h=(require("util").inspect(n),0);h<a.length;h++){var p=a[h],g=n[p],k=r.gex&&g.match(/[\*\?]/)?u(g):null;k&&(k.val$=g);var m=(k?"1":"0")+"~",x=m+p;if(d=c.v,d&&x==c.sk)i(c,p,k),c=d[g]||(d[g]={});else if(c.k)if(x<c.sk){var y=c.s,F=c.g;c.s={k:c.k,sk:c.sk,v:c.v},y&&(c.s.s=y),F&&(c.s.g=F),c.g&&(c.g={}),i(c,p,k),c.k=p,c.sk=x,c.v={},c=c.v[g]={}}else d=c.v,c=c.s||(c.s={}),h--;else i(c,p,k),c.k=p,c.sk=x,c.v={},c=c.v[g]={}}return void 0!==e&&c&&(c.d=e,l&&(c.f=t.isFunction(l)?l:l.find,c.r=t.isFunction(l.remove)?l.remove:void 0)),o},o.findexact=function(n){return o.find(n,!0)},o.find=function(n,e){if(null==n)return null;var u=s,i=void 0===s.d?null:s.d,l=s.f,a=null,v=[],f={},d=t.keys(n).length;do{if(a=u.k,u.v){var c=n[a],h=u.v[c];if(!h&&r.gex&&u.g&&u.g[a])for(var p=u.g[a],g=0;g<p.length;g++)if(null!=p[g].on(c)){h=u.v[p[g].val$];break}h?(f[a]=!0,u.s&&v.push(u.s),i=void 0===h.d?null:h.d,l=h.f,u=h):u=u.s}else u=null;null==u&&null==i&&0<v.length&&(u=v.pop())}while(u);return e&&t.keys(f).length!=d&&(i=null),l&&(i=l.call(o,n,i)),i},o.remove=function(n){var e,r=s,t=null,u=[];do if(e=r.k,r.v){var i=r.v[n[e]];i?(u.push({km:r,v:n[e]}),t=i.d,r=i):r=r.s}else r=null;while(r);if(void 0!==t){var o=u[u.length-1];if(o&&o.km&&o.km.v){var l=o.km.v[o.v];(!l.r||l.r(n,l.d))&&delete l.d}}},o.list=function(n,e){function r(i,o,s,l){if(i.v){var a,v=i.k,f=u(n?null==n[v]?e?null:"*":n[v]:"*"),d=t.extend({},o),c=t.extend({},s);for(var h in i.v)if(f.on(h)){var p=t.clone(d);p[v]=h;var g=t.extend({},c);delete g[v],a=i.v[h],0===t.keys(g).length&&a&&a.d&&l.push({match:p,data:a.d,find:a.f}),a&&a.v&&r(a,t.extend({},p),t.extend({},g),l)}a=i.s,a&&r(a,t.extend({},d),t.extend({},c),l)}}var i=[];return s.d&&i.push({match:{},data:s.d,find:s.f}),r(s,{},t.extend({},n),i),i},o.toString=function(){function n(n,e){for(var r=0;e>r;r++)n.push(" ")}function e(r,o,s,l){var a;if(void 0!==r.d&&(o.push(" "+u(r.d)),i.push(l.join(", ")+" -> "+u(r.d))),r.k&&(o.push("\n"),n(o,s),o.push(r.k+":")),r.v){s++;var v=t.keys(r.v),f=t.filter(v,function(n){return!n.match(/[\*\?]/)}),d=t.filter(v,function(n){return n.match(/[\*\?]/)});f.sort(),d.sort(),v=f.concat(d);for(var c=0;c<v.length;c++){var h=v[c];o.push("\n"),n(o,s),o.push(h+" ->"),a=t.clone(l),a.push(r.k+"="+h),e(r.v[h],o,s+1,a)}r.s&&(o.push("\n"),n(o,s),o.push("|"),a=t.clone(l),e(r.s,o,s+1,a))}}var r=t.isBoolean(arguments[0])?arguments[0]:!!arguments[1],u=t.isFunction(arguments[0])?arguments[0]:function(n){return t.isFunction(n)?"<"+n.name+">":"<"+n+">"},i=[],o=[];return e(s,o,0,[]),r?o.join(""):i.join("\n")},o.inspect=o.toString,o.toJSON=function(n){return JSON.stringify(s,function(n,e){return t.isFunction(e)?"[Function]":e},n)},o};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.patrun=i):n.patrun=i}).call(this);
//# sourceMappingURL=patrun-min.map